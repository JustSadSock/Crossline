# Crossline

Браузерная арена с WebSocket-сервером. Клиент развёрнут как статический сайт (например, на Netlify)
и автоматически подключается к серверу, который работает локально и отдается наружу через туннель.

## Что входит

- `/index.html`, `/scripts`, `/styles` — интерфейс лобби и игры.
- `/server` — Node.js/WebSocket-сервер для матчмейкинга и синхронизации.
- `expose-server.bat` — Windows-скрипт, который поднимает сервер локально и сразу публикует его через ngrok.
- `/scripts/runtime-config.js` — конфигурация клиента с актуальным публичным адресом туннеля.

## Как выдать локальный сервер наружу (Windows)

1. Установите [Node.js LTS](https://nodejs.org/) и [ngrok](https://ngrok.com/). Сохраните путь к `ngrok.exe`.
2. (Опционально) задайте токен `NGROK_AUTHTOKEN`, чтобы туннель поднимался без ручного логина.
3. В корне репозитория запустите `expose-server.bat`. Скрипт:
   - проверит наличие Node.js и npm;
   - установит зависимости (`npm ci`, только при отсутствии `node_modules`);
   - запустит сервер на `http://localhost:3000` в отдельном окне;
   - поднимет ngrok-туннель и выведет публичный URL в консоли;
   - при наличии `monitor-server.ps1` откроет окно мониторинга.
4. Скопируйте опубликованный адрес (формата `https://*.ngrok.app`) и пропишите его в `scripts/runtime-config.js`,
   чтобы игроки подключались к актуальному серверу.

## Обновление конфигурации клиента

Файл [`scripts/runtime-config.js`](scripts/runtime-config.js) разворачивается вместе со статическим сайтом и
определяет, к какому туннелю подключается клиент. Перед публикацией замените значение `tunnelOrigin` на
актуальный адрес, например:

```js
const tunnelOrigin = 'https://example.eu.ngrok.app';
```

После изменения задеплойте сайт, чтобы все посетители автоматически подключились к новому серверу.

### Полезные переменные окружения

| Переменная        | Назначение                                                      |
|-------------------|-----------------------------------------------------------------|
| `PORT`            | Локальный порт сервера (по умолчанию `3000`).                   |
| `NGROK_EXE`       | Полный путь до `ngrok.exe`, если он не прописан в `PATH`.       |
| `NGROK_AUTHTOKEN` | Токен авторизации ngrok; если не задан, ngrok запросит вход.    |

## Работа с клиентом

Онлайн-режим подключается к адресу, указанному в `runtime-config.js`. Если туннель недоступен,
интерфейс покажет уведомление и отключит возможность входа в комнаты. Офлайн-режим с ботом доступен без сервера.

## Скрипты npm

- `npm run test` — проверка синтаксиса серверной части (`node --check server/index.js`).

## Минимальный стек

- Node.js 18+
- WebSocket (`ws`)
- Чистый JavaScript, Canvas и CSS для клиента

